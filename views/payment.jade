doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1, shrink-to-fit=no')
    meta(name='description', content='')
    meta(name='author', content='')
    link(rel='icon', type='image/png', href='/Homepage/images/favicon.png')
    title Elite-SMS Credentials
    // Custom fonts for this template
    link(href='/vendor/fontawesome-free/css/all.min.css', rel='stylesheet', type='text/css')
    // Page level plugin CSS
    link(href='/vendor/datatables/dataTables.bootstrap4.css', rel='stylesheet')
    // Custom styles for this template
    link(href='/css/sb-admin.css', rel='stylesheet')
    style.
      #test
      {
        display:none
      }
      #hide
      {
        display:none
      }
      .navbar-default
      {
        background-color:white;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }
      #content-wrapper
      {
         margin-bottom:100px;
         margin-top:10px;
      }

  body#page-top
    nav.navbar.navbar-expand.navbar-dark.navbar-default.static-top
      a.navbar-brand.mr-1(href='/dashboard') 
       img(src='/Homepage/images/logo.png', alt='alternative')
      button.navbar-toggler(type='button', data-toggle='collapse', data-target='#navbarText', aria-controls='navbarText', aria-expanded='false', aria-label='Toggle navigation')
        span.navbar-toggler-icon
      #navbarText.collapse.navbar-collapse
        ul.navbar-nav.ml-auto
        
          li.nav-item.active
           
            a(href="/dashboard").btn.btn-info AT Balance #{user.atAmount}
            &nbsp;&nbsp;&nbsp;&nbsp;
                  
          li.nav-item
           
            a(href="/payments").btn.btn-success Account Balance #{amount}
            &nbsp;&nbsp;&nbsp;&nbsp;
          li.nav-item
        span(style='font-weight:bolder;margin-right:5px') #{user.companyname}
        &nbsp;&nbsp;&nbsp;&nbsp;
        img(src='/images/business.png', alt='alternative',width='3%')
    #wrapper
      // Sidebar
      ul.sidebar.navbar-nav
        li.nav-item.active
          a.nav-link(href='/dashboard')
            i.fas.fa-home
            &nbsp;
            span Dashboard
        li.nav-item.active
          a.nav-link(href='/groups')
            i.fas.fa-fw.fa-users
            &nbsp;
            span Groups
       
        li.nav-item
          a.nav-link(href='/recurrence')
            i.fas.fa-fw.fa-clock
            &nbsp;
            span Recurrence
        li.nav-item
          a.nav-link(href='/credentials')
            i.fas.fa-fw.fa-key
            &nbsp;
            span Credentials
        li.nav-item
          a.nav-link(href='/templates')
            i.fas.fa-book-open
            &nbsp;
            span SMS Templates
       
        
        li.nav-item
          a.nav-link(href='/school-exam')
         
            i.fab.fa-elementor
            &nbsp;
            span Send Exam Results
        li.nav-item
          a.nav-link(href='/school-balance')
         
            i.fas.fa-balance-scale
            &nbsp;
            span Send Fee Balances
        li.nav-item
          a.nav-link(href='/history')
            i.fas.fa-fw.fa-history
            &nbsp;
            span History
        li.nav-item.dropdown
          a.nav-link.dropdown-toggle(data-toggle='dropdown', href='#')
            i.fas.fa-money-bill
            &nbsp;
            span Billing
          .dropdown-menu
              a.dropdown-item(href='/paymentMethods') Payment Methods
              a.dropdown-item(href='/accountTransactions') Account Transactions
        
        li.nav-item
          a#erase.nav-link(href='/dashboard-logout')
            i.fas.fa-fw.fa-sign-out-alt
            &nbsp;
            span Logout
      #content-wrapper
        .container-fluid
          // Breadcrumbs
          ol.breadcrumb
            li.breadcrumb-item
              a(href='/payments') Payments
            li.breadcrumb-item.active Overview
          != messages('message', locals)
          #customerButtons
            .row
              
              .col
                
              
              .col
               .container(style='margin-top:80px')
                  .card.card-register.mx-auto.mt-5
                    .card-header Pay your bill now
                    .card-body(style='text-align:center')
                       #hide
                        input#email(type="email",value=user.email)
                        br
                        input#phone(type="number",value=user.amount)
                       
                       h1 #{amount}
                       br
                       button.btn.btn-primary.btn-block(type='button', onclick='payWithRave()') Pay Now

                
              .col
             
            
          // Icon Cards
          #continue.row(style='display:none')
            .col
            .col(style='margin-top:180px')
              p(style='font-weight:bolder;color:black;opacity:0.7;font-size:2.0em;text-align:center') Please log in to continue...
            .col
          #connection.row(style='display:none')
            .col
            .col(style='margin-top:180px')
              p(style='font-weight:bolder;color:black;opacity:0.7;font-size:2.0em;text-align:center') Please connect to the internet...
            .col
          // Area Chart Example
          // DataTables Example
          // /.container-fluid
          // Sticky Footer
          footer.sticky-footer
            .container.my-auto
              .copyright.text-center.my-auto
                span Copyright © Elite-SMS #{year}
        // /.content-wrapper
        // /#wrapper
        // Scroll to Top Button
        a.scroll-to-top.rounded(href='#page-top')
          i.fas.fa-angle-up
        // Logout Modal
        #logoutModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
          .modal-dialog(role='document')
            .modal-content
              .modal-header
                h5#exampleModalLabel.modal-title Ready to Leave?
                button.close(type='button', data-dismiss='modal', aria-label='Close')
                  span(aria-hidden='true') ×
              .modal-body Select "Logout" below if you are ready to end your current session.
              .modal-footer
                button.btn.btn-secondary(type='button', data-dismiss='modal') Cancel
                a.btn.btn-primary(href='login.html') Logout
        // Bootstrap core JavaScript
        script(src='/vendor/jquery/jquery.min.js')
        script(src='/vendor/bootstrap/js/bootstrap.bundle.min.js')
        // Core plugin JavaScript
        script(src='/vendor/jquery-easing/jquery.easing.min.js')
        // Page level plugin JavaScript
        script(src='/vendor/chart.js/Chart.min.js')
        script(src='/vendor/datatables/jquery.dataTables.js')
        script(src='/vendor/datatables/dataTables.bootstrap4.js')
        // Custom scripts for all pages
        script(src='/js/sb-admin.min.js')
        // Demo scripts for this page
        script(src='/js/demo/datatables-demo.js')
        script(src='/js/demo/chart-area-demo.js')
        script(src='https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js')

        script.
          const API_publicKey = "FLWPUBK-2b529d6ba589b3559aa553234359339f-X";
          const email = document.getElementById("email").value;
          const amount = document.getElementById("phone").value;
          function payWithRave() {
         
          var x = getpaidSetup({
          PBFPubKey: API_publicKey,
          customer_email:email,
          amount: amount,
         
          currency: "KES",
          country:'KE',
          txref: "rave-123456",
          meta: [{
          metaname: "flightID",
          metavalue: "AP1234"
          }],
          onclose: function() {},
          callback: function(response) {
          var txref = response.tx.txRef; // collect txRef returned and pass to a 					server page to complete status check.
          console.log("This is the response returned after a charge", response);
          if (
          response.tx.chargeResponseCode == "00" ||
          response.tx.chargeResponseCode == "0"
          ) {
          // redirect to a success page
        
          fetch('/updatePayment',{
            method:'POST',
            headers:{
              'Accept':'application/json',
              'Content-Type':'application/json'
            },
            body:JSON.stringify(response.data)
          }).then((res)=>res.json()).then((response)=>{
            if(response.success ===true)
            {
              console.log('Success')
              window.location.replace('/dashboard')
            }
          })
          } else {
          // redirect to a failure page.
          }
          x.close(); // use this to close the modal immediately after payment.
          }
          });
          }


